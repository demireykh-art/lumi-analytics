<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë£¨ë¯¸í´ë¦¬ë‹‰ ë§¤ì¶œ ë¶„ì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .tier-1 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .tier-2 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .tier-3 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDnkKNXNnDVlcPd5Y1fl59YysdeEZi7uJU",
            authDomain: "lumiclinic-c1a95.firebaseapp.com",
            projectId: "lumiclinic-c1a95",
            storageBucket: "lumiclinic-c1a95.firebasestorage.app",
            messagingSenderId: "901456209944",
            appId: "1:901456209944:web:f287418cd0541f324d3b6d",
            measurementId: "G-J5Y2T8L1SL"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.firestore();

        // Tier ë¶„ë¥˜
        const tierRules = {
            tier1: ['í¬ë‹¤ì´ìŠ¤', 'ë¯¸ì„¸ì ˆê°œ', 'ìœ„ë„ˆ', 'special-êµ¬ë©', 'special-í¬ë‹¤ì´ìŠ¤'],
            tier2: ['ë¦¬íŒŸ', 'í‘ì', 'BBL', 'bbl', 'ì¥¬ë¸Œì  ', 'í¸ì‚¬', 'í¸í‰ì‚¬ë§ˆê·€', 'ì‹¤ë¦¬í”„íŒ…', 'ì˜¬ë¦¬ì§€ì˜¤', 'ì‹¤íŒ'],
            tier3: ['í† ë‹', 'ë³´í†¡ìŠ¤', 'ë¶€ìŠ¤í„°', 'LDM', 'ì½”ë ˆì§€', 'í”¼ì§€ì„ ', 'ì¬ìƒ', 'í•˜í˜', 'ì œëª¨', 'ì ', 'ì¡í‹°']
        };

        const getTier = (name) => {
            const n = (name || '').toLowerCase();
            if (tierRules.tier1.some(k => n.includes(k.toLowerCase()))) return 1;
            if (tierRules.tier2.some(k => n.includes(k.toLowerCase()))) return 2;
            return 3;
        };

        const formatCurrency = (num) => {
            if (!num || isNaN(num)) return '0';
            if (num >= 100000000) return `${(num / 100000000).toFixed(1)}ì–µ`;
            if (num >= 10000) return `${Math.round(num / 10000).toLocaleString()}ë§Œ`;
            return num.toLocaleString();
        };

        // ë¡œê·¸ì¸
        const Login = ({ onLogin }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = () => {
                if (password === 'lumi2025') {
                    localStorage.setItem('lumi_auth', 'true');
                    onLogin(true);
                } else {
                    setError('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                }
            };

            return (
                <div className="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div className="bg-white rounded-2xl p-8 w-full max-w-md card-shadow">
                        <h1 className="text-2xl font-bold text-center mb-2">ë£¨ë¯¸í´ë¦¬ë‹‰</h1>
                        <p className="text-gray-500 text-center mb-6">ë§¤ì¶œ ë¶„ì„ ì‹œìŠ¤í…œ</p>
                        <input
                            type="password"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                            className="w-full px-4 py-3 border rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                        />
                        {error && <p className="text-red-500 text-sm mb-4">{error}</p>}
                        <button onClick={handleLogin} className="w-full gradient-bg text-white py-3 rounded-lg font-medium hover:opacity-90">
                            ë¡œê·¸ì¸
                        </button>
                    </div>
                </div>
            );
        };

        // í†µê³„ ì¹´ë“œ
        const StatCard = ({ title, value, subValue, color, icon }) => (
            <div className={`bg-white rounded-xl p-4 card-shadow border-l-4 ${color}`}>
                <p className="text-gray-500 text-xs">{title}</p>
                <p className="text-xl font-bold mt-1">{value}</p>
                {subValue && <p className="text-gray-400 text-xs mt-1">{subValue}</p>}
            </div>
        );

        // Tier ì¹´ë“œ
        const TierCard = ({ tier, data }) => {
            const bgClass = tier === 1 ? 'tier-1' : tier === 2 ? 'tier-2' : 'tier-3';
            const label = tier === 1 ? 'ì›ì¥ì „ìš©' : tier === 2 ? 'êµìœ¡í›„ê°€ëŠ¥' : 'í‘œì¤€í™”';
            return (
                <div className={`${bgClass} rounded-xl p-4 text-white card-shadow`}>
                    <p className="text-white/80 text-xs">Tier {tier} Â· {label}</p>
                    <p className="text-2xl font-bold">{data.percentage}%</p>
                    <p className="text-lg font-bold">{formatCurrency(data.revenue)}</p>
                    <p className="text-xs text-white/80">{data.count}ê±´</p>
                </div>
            );
        };

        // ì‹œìˆ  í…Œì´ë¸”
        const ItemTable = ({ items, onTierChange }) => (
            <div className="bg-white rounded-xl card-shadow overflow-hidden">
                <div className="p-4 border-b">
                    <h3 className="font-bold">ìƒìœ„ ë§¤ì¶œ ì‹œìˆ  ({items.length}ê°œ)</h3>
                </div>
                <div className="overflow-x-auto max-h-96">
                    <table className="w-full text-sm">
                        <thead className="bg-gray-50 sticky top-0">
                            <tr>
                                <th className="px-3 py-2 text-left">ì‹œìˆ ëª…</th>
                                <th className="px-3 py-2 text-right">ë§¤ì¶œ</th>
                                <th className="px-3 py-2 text-right">ê±´ìˆ˜</th>
                                <th className="px-3 py-2 text-right">ê°ë‹¨ê°€</th>
                                <th className="px-3 py-2 text-center">Tier</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y">
                            {items.slice(0, 30).map((item, i) => (
                                <tr key={i} className="hover:bg-gray-50">
                                    <td className="px-3 py-2 max-w-[180px] truncate" title={item.name}>{item.name}</td>
                                    <td className="px-3 py-2 text-right font-medium">{formatCurrency(item.revenue)}</td>
                                    <td className="px-3 py-2 text-right">{item.count}</td>
                                    <td className="px-3 py-2 text-right">{formatCurrency(item.avgPrice)}</td>
                                    <td className="px-3 py-2 text-center">
                                        <select 
                                            value={item.tier}
                                            onChange={(e) => onTierChange(i, Number(e.target.value))}
                                            className={`text-xs rounded px-1 py-0.5 border-0 ${
                                                item.tier === 1 ? 'bg-pink-100 text-pink-700' :
                                                item.tier === 2 ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700'
                                            }`}
                                        >
                                            <option value={1}>T1</option>
                                            <option value={2}>T2</option>
                                            <option value={3}>T3</option>
                                        </select>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // ë¶€ì›ì¥ ì‹œë®¬ë ˆì´ì…˜
        const AssociateSimulation = () => {
            const [days, setDays] = useState(3);
            const [t2, setT2] = useState(30);
            const daily = days === 3 ? 4200000 : days === 4 ? 5600000 : 4000000;
            const monthly = daily * days * 4;
            const t2Rev = monthly * t2 / 100, t3Rev = monthly * (100-t2) / 100;

            return (
                <div className="space-y-4">
                    <div className="bg-white rounded-xl p-4 card-shadow">
                        <h3 className="font-bold mb-4">ğŸ¯ ë¶€ì›ì¥ ë§¤ì¶œ ì‹œë®¬ë ˆì´ì…˜</h3>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="text-sm text-gray-500 block mb-2">ê·¼ë¬´ì¼</label>
                                <div className="flex gap-2">
                                    {[3,4,5].map(d => (
                                        <button key={d} onClick={() => setDays(d)}
                                            className={`flex-1 py-2 rounded-lg text-sm ${days === d ? 'gradient-bg text-white' : 'bg-gray-100'}`}>
                                            ì£¼{d}ì¼
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div>
                                <label className="text-sm text-gray-500 block mb-2">Tier2: {t2}%</label>
                                <input type="range" min="10" max="50" value={t2} onChange={e => setT2(Number(e.target.value))} className="w-full"/>
                            </div>
                        </div>
                        <div className="grid grid-cols-4 gap-2">
                            <div className="bg-purple-50 rounded-lg p-3 text-center">
                                <p className="text-xs text-gray-500">ì›”ëª©í‘œ</p>
                                <p className="text-lg font-bold text-purple-600">{formatCurrency(monthly)}</p>
                            </div>
                            <div className="bg-blue-50 rounded-lg p-3 text-center">
                                <p className="text-xs text-gray-500">Tier2</p>
                                <p className="text-lg font-bold text-blue-600">{formatCurrency(t2Rev)}</p>
                            </div>
                            <div className="bg-green-50 rounded-lg p-3 text-center">
                                <p className="text-xs text-gray-500">Tier3</p>
                                <p className="text-lg font-bold text-green-600">{formatCurrency(t3Rev)}</p>
                            </div>
                            <div className="bg-orange-50 rounded-lg p-3 text-center">
                                <p className="text-xs text-gray-500">ì¼ëª©í‘œ</p>
                                <p className="text-lg font-bold text-orange-600">{formatCurrency(daily)}</p>
                            </div>
                        </div>
                    </div>
                    <div className="bg-white rounded-xl p-4 card-shadow">
                        <h3 className="font-bold mb-3">ğŸ“Š ë²¤ì¹˜ë§ˆí¬</h3>
                        <div className="grid grid-cols-3 gap-2 text-center">
                            <div className="border rounded-lg p-3"><p className="text-xs text-gray-500">ìµœê³ </p><p className="text-xl font-bold text-purple-600">9ì²œ</p><p className="text-xs text-gray-400">ì£¼4ì¼</p></div>
                            <div className="border rounded-lg p-3"><p className="text-xs text-gray-500">ì—‘ìŠ¤í¼íŠ¸</p><p className="text-xl font-bold text-blue-600">5.9ì²œ</p><p className="text-xs text-gray-400">ì£¼3ì¼</p></div>
                            <div className="border rounded-lg p-3 bg-green-50 border-green-300"><p className="text-xs text-gray-500">ëª©í‘œ</p><p className="text-xl font-bold text-green-600">5ì²œ</p><p className="text-xs text-gray-400">ì£¼3ì¼</p></div>
                        </div>
                    </div>
                    <div className="bg-white rounded-xl p-4 card-shadow">
                        <h3 className="font-bold mb-3">ğŸ¯ ì˜¨ë³´ë”© ë¡œë“œë§µ</h3>
                        {[{m:'1ê°œì›”', t:'2ì²œë§Œ', d:'Tier3 ì§‘ì¤‘'}, {m:'2~3ê°œì›”', t:'3.5ì²œë§Œ', d:'Tier2 êµìœ¡'}, {m:'4~6ê°œì›”', t:'5ì²œë§Œ', d:'T2+T3 ìµœì í™”'}].map((s,i) => (
                            <div key={i} className="flex gap-3 items-start mb-3">
                                <div className="w-7 h-7 rounded-full gradient-bg flex items-center justify-center text-white text-sm font-bold">{i+1}</div>
                                <div><p className="font-medium">{s.m}: {s.t}</p><p className="text-sm text-gray-500">{s.d}</p></div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // ë°ì´í„° ì—…ë¡œë“œ
        const DataUpload = ({ onUpload, data }) => {
            const fileRef = useRef(null);
            const [msg, setMsg] = useState('');
            const [loading, setLoading] = useState(false);

            const parseNum = v => parseFloat(String(v||'').replace(/[^0-9.-]/g,'')) || 0;

            const handleFile = e => {
                const file = e.target.files[0];
                if (!file) return;
                setLoading(true);
                const reader = new FileReader();
                reader.onload = evt => {
                    try {
                        let rows;
                        if (file.name.endsWith('.csv')) {
                            rows = Papa.parse(evt.target.result, {header:true, skipEmptyLines:true}).data;
                        } else {
                            const wb = XLSX.read(evt.target.result, {type:'binary'});
                            rows = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
                        }
                        const items = rows.filter(r => r['ì˜¤ë”ëª…ì¹­']||r['ì˜¤ë”ëª…']||r['ì‹œìˆ ëª…'])
                            .map(r => {
                                const name = r['ì˜¤ë”ëª…ì¹­']||r['ì˜¤ë”ëª…']||r['ì‹œìˆ ëª…']||'';
                                const rev = parseNum(r['ì˜¤ë”ì´ì•¡']||r['ë§¤ì¶œ']);
                                const cnt = parseNum(r['ì˜¤ë”íšŸìˆ˜']||r['ê±´ìˆ˜']||r['íšŸìˆ˜']) || 1;
                                return { name, category: r['ë¶„ë¥˜']||'ê¸°íƒ€', count: cnt, revenue: rev, unitPrice: parseNum(r['ë‹¨ê°€']), avgPrice: Math.round(rev/cnt), tier: getTier(name) };
                            }).filter(i => i.revenue > 0).sort((a,b) => b.revenue - a.revenue);
                        setMsg(`${items.length}ê°œ ë¡œë“œ ì™„ë£Œ`);
                        onUpload(items);
                    } catch(err) { setMsg('ì˜¤ë¥˜: ' + err.message); }
                    setLoading(false);
                };
                file.name.endsWith('.csv') ? reader.readAsText(file,'UTF-8') : reader.readAsBinaryString(file);
            };

            const saveFirebase = async () => {
                if (!data?.length) return setMsg('ì €ì¥í•  ë°ì´í„° ì—†ìŒ');
                setLoading(true);
                try {
                    await db.collection('revenue').doc('data').set({ items: data, updatedAt: firebase.firestore.FieldValue.serverTimestamp() });
                    setMsg('Firebase ì €ì¥ ì™„ë£Œ!');
                } catch(e) { setMsg('ì €ì¥ ì˜¤ë¥˜: ' + e.message); }
                setLoading(false);
            };

            const loadFirebase = async () => {
                setLoading(true);
                try {
                    const doc = await db.collection('revenue').doc('data').get();
                    if (doc.exists && doc.data().items) {
                        onUpload(doc.data().items);
                        setMsg(`Firebaseì—ì„œ ${doc.data().items.length}ê°œ ë¡œë“œ`);
                    } else setMsg('ì €ì¥ëœ ë°ì´í„° ì—†ìŒ');
                } catch(e) { setMsg('ë¡œë“œ ì˜¤ë¥˜: ' + e.message); }
                setLoading(false);
            };

            return (
                <div className="space-y-4">
                    <div className="bg-white rounded-xl p-4 card-shadow">
                        <h3 className="font-bold mb-4">ğŸ“Š ë°ì´í„° ì—…ë¡œë“œ</h3>
                        <input type="file" ref={fileRef} onChange={handleFile} accept=".csv,.xlsx,.xls" className="hidden"/>
                        <button onClick={() => fileRef.current.click()} disabled={loading}
                            className="w-full border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-purple-400 hover:bg-purple-50">
                            {loading ? <span className="flex items-center justify-center"><div className="loading-spinner mr-2"></div>ì²˜ë¦¬ì¤‘...</span> : <><span className="text-3xl block mb-2">ğŸ“</span><span className="text-gray-500">CSV/Excel íŒŒì¼ ì„ íƒ</span></>}
                        </button>
                        {msg && <p className={`mt-3 text-sm ${msg.includes('ì˜¤ë¥˜') ? 'text-red-500' : 'text-green-600'}`}>{msg}</p>}
                    </div>
                    <div className="bg-white rounded-xl p-4 card-shadow">
                        <h3 className="font-bold mb-4">ğŸ”— Firebase ë™ê¸°í™”</h3>
                        <div className="flex gap-3">
                            <button onClick={saveFirebase} disabled={loading||!data?.length} className="flex-1 gradient-bg text-white py-3 rounded-lg disabled:opacity-50">ğŸ’¾ ì €ì¥</button>
                            <button onClick={loadFirebase} disabled={loading} className="flex-1 bg-gray-100 py-3 rounded-lg">ğŸ“¥ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        </div>
                        <p className="mt-3 text-xs text-gray-500">í˜„ì¬: {data?.length||0}ê°œ í•­ëª© ({formatCurrency(data?.reduce((s,i)=>s+i.revenue,0)||0)})</p>
                    </div>
                </div>
            );
        };

        // ì‹œìˆ  êµ¬ì¡°í™”
        const TreatmentStructure = ({ items }) => {
            const [sel, setSel] = useState(null);
            const tierItems = { 1: items.filter(i=>i.tier===1), 2: items.filter(i=>i.tier===2), 3: items.filter(i=>i.tier===3) };
            const info = { 1:{label:'ì›ì¥ì „ìš©',desc:'ê³ ë‚œì´ë„, ë¸Œëœë”© í•µì‹¬'}, 2:{label:'êµìœ¡í›„ê°€ëŠ¥',desc:'í”„ë¡œí† ì½œ êµìœ¡ í•„ìš”'}, 3:{label:'í‘œì¤€í™”',desc:'ì¦‰ì‹œ ìœ„ì„ ê°€ëŠ¥'} };

            return (
                <div className="space-y-4">
                    <div className="bg-white rounded-xl p-4 card-shadow">
                        <h3 className="font-bold mb-4">ğŸ¯ ì‹œìˆ  êµ¬ì¡°í™”</h3>
                        <div className="grid grid-cols-3 gap-3">
                            {[1,2,3].map(t => (
                                <button key={t} onClick={() => setSel(sel===t?null:t)} className={`p-4 rounded-xl ${sel===t ? `tier-${t} text-white` : 'bg-gray-100'}`}>
                                    <p className="font-bold">Tier {t}</p>
                                    <p className="text-xs opacity-80">{info[t].label}</p>
                                    <p className="text-lg font-bold mt-2">{tierItems[t].length}ê°œ</p>
                                    <p className="text-xs opacity-80">{formatCurrency(tierItems[t].reduce((s,i)=>s+i.revenue,0))}</p>
                                </button>
                            ))}
                        </div>
                    </div>
                    {sel && (
                        <div className="bg-white rounded-xl p-4 card-shadow">
                            <h4 className="font-bold mb-2">Tier {sel}: {info[sel].label}</h4>
                            <p className="text-sm text-gray-500 mb-3">{info[sel].desc}</p>
                            <div className="space-y-1 max-h-60 overflow-y-auto">
                                {tierItems[sel].map((item,i) => (
                                    <div key={i} className="flex justify-between p-2 bg-gray-50 rounded text-sm">
                                        <span className="truncate max-w-[60%]">{item.name}</span>
                                        <span className="font-medium">{formatCurrency(item.revenue)}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    <div className="bg-white rounded-xl p-4 card-shadow">
                        <h3 className="font-bold mb-3">ğŸ’¡ ì¸ì‚¬ì´íŠ¸</h3>
                        <div className="space-y-2">
                            <div className="p-3 bg-pink-50 rounded-lg"><p className="font-medium text-pink-700">Tier1 - ì›ì¥ ì§‘ì¤‘</p><p className="text-sm text-gray-600">ë¸Œëœë”© ìœ ì§€, ê³ ê° ì‹ ë¢° í•µì‹¬</p></div>
                            <div className="p-3 bg-blue-50 rounded-lg"><p className="font-medium text-blue-700">Tier2 - ë¶€ì›ì¥ êµìœ¡</p><p className="text-sm text-gray-600">í”„ë¡œí† ì½œí™” â†’ ë§¤ì¶œ í•µì‹¬</p></div>
                            <div className="p-3 bg-green-50 rounded-lg"><p className="font-medium text-green-700">Tier3 - ì¦‰ì‹œ ìœ„ì„</p><p className="text-sm text-gray-600">ì²«ë‹¬ë¶€í„° ë§¤ì¶œ ê¸°ì—¬</p></div>
                        </div>
                    </div>
                </div>
            );
        };

        // ëŒ€ì‹œë³´ë“œ
        const Dashboard = ({ onLogout }) => {
            const [tab, setTab] = useState('overview');
            const [data, setData] = useState([]);

            useEffect(() => {
                const saved = localStorage.getItem('lumi_data');
                if (saved) setData(JSON.parse(saved));
            }, []);

            const handleUpload = d => { setData(d); localStorage.setItem('lumi_data', JSON.stringify(d)); };
            const handleTierChange = (i, t) => { const d = [...data]; d[i].tier = t; handleUpload(d); };

            const total = data.reduce((s,i) => s + (i.revenue||0), 0);
            const count = data.reduce((s,i) => s + (i.count||0), 0);
            const tierData = [1,2,3].map(t => {
                const items = data.filter(i => i.tier === t);
                const rev = items.reduce((s,i) => s+i.revenue, 0);
                return { revenue: rev, count: items.reduce((s,i) => s+i.count, 0), percentage: total ? Math.round(rev/total*100) : 0 };
            });

            const categories = Object.entries(data.reduce((acc, i) => {
                const c = i.category || 'ê¸°íƒ€';
                if (!acc[c]) acc[c] = {revenue:0, count:0};
                acc[c].revenue += i.revenue||0;
                acc[c].count += i.count||0;
                return acc;
            }, {})).map(([name, stats]) => ({name, ...stats})).sort((a,b) => b.revenue - a.revenue).slice(0,10);

            const tabs = [{id:'overview',l:'ğŸ“Š ê°œìš”'},{id:'tier',l:'ğŸ¯ ë¶„ë¥˜'},{id:'assoc',l:'ğŸ‘¨â€âš•ï¸ ë¶€ì›ì¥'},{id:'upload',l:'ğŸ“ ë°ì´í„°'}];

            return (
                <div className="min-h-screen bg-gray-50">
                    <header className="gradient-bg text-white p-4 sticky top-0 z-50">
                        <div className="max-w-4xl mx-auto flex justify-between items-center">
                            <div><h1 className="text-lg font-bold">ë£¨ë¯¸í´ë¦¬ë‹‰</h1><p className="text-white/70 text-xs">ë§¤ì¶œ ë¶„ì„</p></div>
                            <div className="flex items-center gap-4">
                                <div className="text-right"><p className="text-xs text-white/70">ì´ë§¤ì¶œ</p><p className="font-bold">{formatCurrency(total)}</p></div>
                                <button onClick={onLogout} className="text-white/70 hover:text-white text-sm">ë¡œê·¸ì•„ì›ƒ</button>
                            </div>
                        </div>
                    </header>
                    <div className="bg-white border-b sticky top-14 z-40">
                        <div className="max-w-4xl mx-auto flex">
                            {tabs.map(t => (
                                <button key={t.id} onClick={() => setTab(t.id)} className={`flex-1 py-3 text-sm ${tab === t.id ? 'border-b-2 border-purple-500 text-purple-600 font-medium' : 'text-gray-500'}`}>{t.l}</button>
                            ))}
                        </div>
                    </div>
                    <main className="max-w-4xl mx-auto p-4">
                        {tab === 'overview' && (
                            data.length === 0 ? (
                                <div className="bg-white rounded-xl p-8 card-shadow text-center">
                                    <span className="text-4xl block mb-4">ğŸ“Š</span>
                                    <p className="text-gray-500 mb-4">ë°ì´í„°ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</p>
                                    <button onClick={() => setTab('upload')} className="gradient-bg text-white px-6 py-2 rounded-lg">ë°ì´í„° ì—…ë¡œë“œ</button>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        <StatCard title="ì´ë§¤ì¶œ" value={formatCurrency(total)} color="border-purple-500"/>
                                        <StatCard title="ì›”í‰ê· " value={formatCurrency(total/11)} subValue="ëª©í‘œ:1.5ì–µ" color="border-blue-500"/>
                                        <StatCard title="ì‹œìˆ ê±´ìˆ˜" value={count.toLocaleString()} color="border-green-500"/>
                                        <StatCard title="ê°ë‹¨ê°€" value={formatCurrency(count?Math.round(total/count):0)} color="border-orange-500"/>
                                    </div>
                                    <div className="grid grid-cols-3 gap-3">
                                        <TierCard tier={1} data={tierData[0]}/>
                                        <TierCard tier={2} data={tierData[1]}/>
                                        <TierCard tier={3} data={tierData[2]}/>
                                    </div>
                                    {categories.length > 0 && (
                                        <div className="bg-white rounded-xl p-4 card-shadow">
                                            <h3 className="font-bold mb-3">ì¹´í…Œê³ ë¦¬ë³„ ë§¤ì¶œ</h3>
                                            {categories.map((c,i) => (
                                                <div key={i} className="mb-2">
                                                    <div className="flex justify-between text-sm mb-1"><span className="truncate">{c.name}</span><span className="font-medium">{formatCurrency(c.revenue)}</span></div>
                                                    <div className="w-full bg-gray-100 rounded-full h-2"><div className="gradient-bg h-2 rounded-full" style={{width:`${c.revenue/categories[0].revenue*100}%`}}/></div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    <ItemTable items={data} onTierChange={handleTierChange}/>
                                </div>
                            )
                        )}
                        {tab === 'tier' && <TreatmentStructure items={data}/>}
                        {tab === 'assoc' && <AssociateSimulation/>}
                        {tab === 'upload' && <DataUpload onUpload={handleUpload} data={data}/>}
                    </main>
                </div>
            );
        };

        // App
        const App = () => {
            const [auth, setAuth] = useState(() => localStorage.getItem('lumi_auth') === 'true');
            const logout = () => { localStorage.removeItem('lumi_auth'); setAuth(false); };
            return auth ? <Dashboard onLogout={logout}/> : <Login onLogin={setAuth}/>;
        };

        ReactDOM.render(<App/>, document.getElementById('root'));
    </script>
</body>
</html>
